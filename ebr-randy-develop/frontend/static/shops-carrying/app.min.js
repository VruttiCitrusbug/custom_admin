let brandSlug,brandName,brandLogoUrl,currentLocation,localShopsContainer,officialShopContainer,onlineShopsContainer;function initShopsCarrying(){var urlPathComponents=window.parent.location.pathname.split("/");brandSlug=urlPathComponents[1],localShopsContainer=document.getElementById("local-shops-container"),officialShopContainer=document.getElementById("official-shop-container"),onlineShopsContainer=document.getElementById("online-shops-container"),""!==(currentLocation=getLocationSearchString())&&(document.getElementById("carrying-location-input").value=beautifySearchString(currentLocation)),document.getElementById("carrying-location-input").placeholder="Enter a location...",fetchShops(currentLocation)}function fetchShops(location){fetch(DASHBOARD_SHOPS_CARRYING_ENDPOINT+"/"+brandSlug+"?location="+location).then(response=>response.json()).then(data=>{brandName=data.brand.name,brandLogoUrl=data.brand.logo_url,populateTitles(brandName),populateShopSections(data.groups)})}function populateTitles(brandName){let titles=document.getElementsByClassName("brand-name");for(let i=0;i<titles.length;i++)titles[i].innerHTML=brandName}function populateShopSections(groups){emptyContainer(localShopsContainer),emptyContainer(officialShopContainer),emptyContainer(onlineShopsContainer),null!==groups.local.shops?(groups.local.shops.forEach(function(shop){populateShop(localShopsContainer,shop,!0,"local")}),document.getElementById("no-local-message").classList.add("hidden"),4<groups.local.shops.length?document.getElementById("show-more").classList.remove("hidden"):document.getElementById("show-more").classList.add("hidden")):document.getElementById("no-local-message").classList.remove("hidden"),null!==groups.official.shops?(groups.official.shops.forEach(function(shop){populateShop(officialShopContainer,shop,!1,"official")}),document.getElementById("official-section").classList.remove("hidden")):document.getElementById("official-section").classList.add("hidden"),null!==groups.online.shops?(groups.online.shops.forEach(function(shop){populateShop(onlineShopsContainer,shop,!1,"online")}),document.getElementById("online-section").classList.remove("hidden")):document.getElementById("online-section").classList.add("hidden")}function emptyContainer(container){for(;container.hasChildNodes();)container.removeChild(container.lastChild)}function populateShop(container,shop,address,type){let shopContainer=document.createElement("div"),shopTopRowContainer=(shopContainer.classList.add("shop-wrapper"),document.createElement("div")),shopLogoContainer=(shopTopRowContainer.classList.add("shop-top-row-wrapper"),document.createElement("div")),shopLogo=(shopLogoContainer.classList.add("shop-logo-wrapper"),document.createElement("img")),shopTitleContainer=(shopLogo.classList.add("shop-logo"),shopLogo.src=brandLogoUrl,shopLogoContainer.appendChild(shopLogo),shopTopRowContainer.appendChild(shopLogoContainer),document.createElement("div"));shopTitleContainer.classList.add("shop-title-wrapper"),(title=document.createElement("h4")).classList.add("shop-title"),shop.name==brandName?title.innerHTML=shop.name+" Official Store":title.innerHTML=shop.name,shopTitleContainer.appendChild(title),address&&((address=document.createElement("div")).classList.add("shop-address"),address.innerHTML=shop.display_address,shopTitleContainer.appendChild(address)),shopTopRowContainer.appendChild(shopTitleContainer),shopContainer.appendChild(shopTopRowContainer),(buttonWrapper=document.createElement("div")).classList.add("shop-buttons"),(websiteButton=document.createElement("a")).classList.add("button","shop-button"),websiteButton.style="margin-right: 1rem;",websiteButton.href=shop.website,websiteButton.target="_blank",websiteButton.rel="nofollow noopener",websiteButton.innerText="Visit Website",websiteButton.dataset.id=shop.id,websiteButton.dataset.target="website",websiteButton.dataset.type=type,websiteButton.onclick=function(event){handleShopClick(event)},(websiteButtonIcon=document.createElement("i")).classList.add("fas","fa-external-link"),websiteButton.appendChild(websiteButtonIcon),buttonWrapper.appendChild(websiteButton),(phoneButton=document.createElement("a")).classList.add("button","shop-button"),phoneButton.rel="nofollow noopener",phoneButton.innerText="Get Phone Number",phoneButton.dataset.id=shop.id,phoneButton.dataset.target="phone",phoneButton.dataset.type=type,phoneButton.dataset.phone=shop.phone,phoneButton.onclick=function(event){this.innerHTML==shop.phone||(handleShopClick(event),event.preventDefault(),this.innerHTML=shop.phone,this.href="tel:"+shop.phone)},(phoneButtonIcon=document.createElement("i")).classList.add("fas","fa-phone"),phoneButton.appendChild(phoneButtonIcon),buttonWrapper.appendChild(phoneButton),shopContainer.appendChild(buttonWrapper),container.appendChild(shopContainer),(divider=document.createElement("hr")).classList.add("shop-divider"),container.appendChild(divider)}function getLocationSearchString(){var search=localStorage.getItem("location");return search||""}function handleShopClick(event){event.isTrusted&&(event=new CustomEvent("shop-click-event",{detail:{id:event.target.dataset.id,placement:"carrying",target:event.target.dataset.target,type:event.target.dataset.type}}),window.parent.document.dispatchEvent(event))}function newCarryingLocationSearch(){let newSearchLocation=document.getElementById("carrying-location-input").value;var event;null==newSearchLocation||0==newSearchLocation.length?alert("Please enter a valid location to search for"):(newSearchLocation=uglifySearchString(newSearchLocation),localStorage.setItem("location",newSearchLocation),fetchShops(currentLocation=newSearchLocation),event=new CustomEvent("location-update-event",{detail:{location:newSearchLocation,source:"carrying"}}),window.parent.document.dispatchEvent(event))}function uglifySearchString(search){return search=search.replace(/\s+/g,"-")}function beautifySearchString(ugly){return ugly.replace(/-+/g," ")}function handleUpdateEvent(event){"carrying"===event.detail.source||(currentlocation=event.detail.location,fetchShops(event.detail.location),document.getElementById("carrying-location-input").value=beautifySearchString(event.detail.location))}document.getElementById("carrying-location-input").addEventListener("keyup",function(event){"Enter"===event.code&&(newCarryingLocationSearch(),event.preventDefault())}),document.getElementById("show-more").onclick=function(ev){localShopsContainer.classList.contains("minimized")?(localShopsContainer.classList.remove("minimized"),ev.target.innerHTML="Show Less Local Shops"):(localShopsContainer.classList.add("minimized"),ev.target.innerHTML="Show More Local Shops")},window.parent.document.addEventListener("location-update-event",handleUpdateEvent);